(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{515:function(t,a,s){"use strict";s.r(a);var n=s(55),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"基于colab和yolov5框架进行枪-剑目标检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于colab和yolov5框架进行枪-剑目标检测"}},[t._v("#")]),t._v(" 基于Colab和Yolov5框架进行枪&剑目标检测")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703213751655.png",alt:"image-20210703213751655"}}),t._v(" "),s("h2",{attrs:{id:"任务概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务概述"}},[t._v("#")]),t._v(" 任务概述")]),t._v(" "),s("p",[t._v("本次的任务："),s("strong",[t._v("用 gun/sword 数据集训练你的物体检测模型，并对数据集中的验证集进行检测，计算出 mAP")]),t._v("。")]),t._v(" "),s("p",[t._v("任务分解为：")]),t._v(" "),s("ul",[s("li",[t._v("选择模型")]),t._v(" "),s("li",[t._v("配置环境")]),t._v(" "),s("li",[t._v("制作数据集")]),t._v(" "),s("li",[t._v("构建模型")]),t._v(" "),s("li",[t._v("训练模型")]),t._v(" "),s("li",[t._v("评估模型")]),t._v(" "),s("li",[t._v("优化和部署模型（可选）")])]),t._v(" "),s("p",[t._v("Yolov5模型训练部分参考Yolov5官方的"),s("a",{attrs:{href:"https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data",target:"_blank",rel:"noopener noreferrer"}},[t._v("Train Custom Data文档")]),t._v("、"),s("a",{attrs:{href:"https://colab.research.google.com/github/ultralytics/yolov5/blob/master/tutorial.ipynb",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方Colab笔记本")]),t._v("、"),s("a",{attrs:{href:"https://blog.roboflow.com/how-to-train-yolov5-on-a-custom-dataset/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Roboflow的Yolov5训练博客")]),t._v("、"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/161778675",target:"_blank",rel:"noopener noreferrer"}},[t._v("知乎：使用Yolov5进行端到端目标检测")]),t._v("以及Harryee同学的"),s("a",{attrs:{href:"https://github.com/Harryee/yolov5_homework/blob/main/readme.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用文档")]),t._v("。wandb的使用参考了wandb官网"),s("a",{attrs:{href:"https://wandb.ai/cayush/yolov5-dsviz-demo/reports/Object-Detection-with-YOLO-and-Weights-Biases--Vmlldzo0NTgzMjk",target:"_blank",rel:"noopener noreferrer"}},[t._v("介绍")]),t._v("和wandb官方的"),s("a",{attrs:{href:"https://colab.research.google.com/drive/1CRC7kxYTIQQysowbrT2L6ctPen6ZQVeN?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[t._v("colab演示笔记本")]),t._v("。")]),t._v(" "),s("p",[t._v("Colab笔记地址： "),s("a",{attrs:{href:"https://colab.research.google.com/drive/1Dwe00BGNNSOVaAXiXiW8GR9OJtpzF6Jc?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703223053458.png",alt:"image-20210703223053458"}})])]),t._v(" "),s("p",[t._v("该项目的wandb形成报告：https://wandb.ai/chancey/yolo-wandb-gw-detect/reports/---Vmlldzo4MjE0NzU")]),t._v(" "),s("p",[t._v("wandb地址：https://wandb.ai/chancey/yolo-wandb-gw-detect/overview?workspace=user-chancey")]),t._v(" "),s("h2",{attrs:{id:"选择模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选择模型"}},[t._v("#")]),t._v(" 选择模型")]),t._v(" "),s("p",[t._v("目标检测的常用模型有Faster R-CNN、SSD和YOLO，在这里使用了Yolo家族的Yolov5作为模型框架。YOLOv5并不是一个单独的模型，而是一个模型家族，包括了YOLOv5s(最小)、YOLOv5m、YOLOv5l、YOLOv5x(最大)。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://github.com/ultralytics/yolov5/releases/download/v1.0/model_comparison.png",alt:"YOLOv5 模型"}})]),t._v(" "),s("blockquote",[s("p",[t._v("图片来源：https://github.com/ultralytics/yolov5")])]),t._v(" "),s("p",[t._v("由于YOLOv5是在PyTorch中实现的，它受益于成熟的PyTorch生态系统，支持更简单，部署更容易，相对于YOLOv4，YOLOv5具有以下优点：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("速度更快")])]),t._v(" "),s("li",[s("p",[t._v("精度更高")])])]),t._v(" "),s("h2",{attrs:{id:"配置环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置环境"}},[t._v("#")]),t._v(" 配置环境")]),t._v(" "),s("p",[t._v("Yolov5可以在windows，macOX，Linux（只要依赖项CUDA/CUDNN、Python和PyTorch都已预装）下运行，然后也可以在一些云平台运行，例如kaggle，colab，亚马逊的AWS和谷歌的GCP。这里使用colab作为环境（因为可以白嫖Tesla T4）。")]),t._v(" "),s("h2",{attrs:{id:"数据收集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据收集"}},[t._v("#")]),t._v(" 数据收集")]),t._v(" "),s("p",[s("strong",[t._v("收集的主要途径：")])]),t._v(" "),s("ul",[s("li",[t._v("公用的数据集")]),t._v(" "),s("li",[t._v("github中去找相似的项目")]),t._v(" "),s("li",[t._v("爬虫去网站上爬取")]),t._v(" "),s("li",[t._v("自行制作")])]),t._v(" "),s("p",[t._v("有时我们可以在网上下载到别人已经训练好的模型，比如下载动物识别的模型，用这个模型去检测我们数据集中的图片，就可以自动生成label,后续只要在模型预测的label的基础上进行调整和增加即可，大大减少了工作量。")]),t._v(" "),s("p",[t._v("在这里我们使用vott自行制作枪🔫&剑🗡数据集。具体方法不再叙述。"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/161778675",target:"_blank",rel:"noopener noreferrer"}},[t._v("知乎：使用Yolov5进行端到端目标检测")]),t._v("中推荐了一个叫Hyperlabel的工具，可以导出多种格式。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/v2-dee4158296cb386f198113bcda87196e_720w.jpg",alt:"img"}})]),t._v(" "),s("p",[t._v("在这里，需要补充yolov5的文件格式要求。")]),t._v(" "),s("h3",{attrs:{id:"yolov5的数据格式要求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yolov5的数据格式要求"}},[t._v("#")]),t._v(" Yolov5的数据格式要求")]),t._v(" "),s("h4",{attrs:{id:"单个数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单个数据"}},[t._v("#")]),t._v(" 单个数据")]),t._v(" "),s("p",[t._v("将标签导出为"),s("strong",[t._v("YOLO 格式")]),t._v("，每个图像各有一个"),s("code",[t._v("*.txt")]),t._v("文件")]),t._v(" "),s("ul",[s("li",[t._v("每个对象一行")]),t._v(" "),s("li",[t._v("每一行都是"),s("code",[t._v("class x_center y_center width height")]),t._v("格式。")]),t._v(" "),s("li",[t._v("框坐标必须采用"),s("strong",[t._v("标准化 xywh")]),t._v("格式（从 0 - 1）。如果您的箱子以像素为单位，划分"),s("code",[t._v("x_center")]),t._v("并"),s("code",[t._v("width")]),t._v("通过图像宽度，"),s("code",[t._v("y_center")]),t._v("并"),s("code",[t._v("height")]),t._v("通过图像高度。")]),t._v(" "),s("li",[t._v("类号是零索引的（从 0 开始）")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/91506361-c7965000-e886-11ea-8291-c72b98c25eec.jpg",alt:"Image Labels"}})]),t._v(" "),s("blockquote",[s("p",[t._v("图片来源：https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data")])]),t._v(" "),s("h4",{attrs:{id:"数据集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据集"}},[t._v("#")]),t._v(" 数据集")]),t._v(" "),s("p",[t._v("yolo训练需要将将训练、验证、测试数据按照图像和标注文件统一到image和labels文件夹中。以下是官方给的数据准备结构。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/20210308142226328.jpg",alt:"在这里插入图片描述"}})]),t._v(" "),s("blockquote",[s("p",[t._v("图片来源：https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("├── data\n│   ├── Annotations  进行 detection 任务时的标签文件，xml 形式，文件名与图片名一一对应\n│   ├── images  存放 .jpg 格式的图片文件\n│   ├── ImageSets  存放的是分类和检测的数据集分割文件，包含train.txt, val.txt,trainval.txt,test.txt\n│   ├── labels  存放label标注信息的txt文件，与图片一一对应\n\n\n├── ImageSets(train，val，test建议按照8：1：1比例划分)\n│   ├── train.txt  写着用于训练的图片名称\n│   ├── val.txt  写着用于验证的图片名称\n│   ├── trainval.txt  train与val的合集\n│   ├── test.txt  写着用于测试的图片名称\n")])])]),s("p",[t._v("如果需要将voc等格式转换为Yolov5格式的话，可以参考这篇博客："),s("a",{attrs:{href:"https://blog.csdn.net/tpz789/article/details/110675268",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSDN：yolov5训练自己的数据集并计算mAP")]),t._v("其中的"),s("code",[t._v("voc_label.py")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"yolov5的配置文件yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yolov5的配置文件yaml"}},[t._v("#")]),t._v(" yolov5的配置文件"),s("code",[t._v("yaml")])]),t._v(" "),s("p",[t._v("训练模型之前需要了解yolov5的核心配置文件，"),s("code",[t._v("*.yaml")]),t._v("，Yolov5可以通过命令行配置"),s("code",[t._v("*.yaml")]),t._v("来进行模型参数的修改，这是和Yolov4的一个区别，提高了使用的简易性。")]),t._v(" "),s("ul",[s("li",[t._v("YAML(YAML Ain`t Markup language)文件，它不是一个标记语言。配置文件有xml、properties等，但YAML是以数据为中心，更适合做配置文件。")]),t._v(" "),s("li",[t._v("YAML的语法和其他高级语言类似，并且可以简单表达清单、散列表，标量等数据形态。")]),t._v(" "),s("li",[t._v("它使用空白符号缩进和大量依赖外观的特色，特别适合用来表达或编辑数据结构、各种配置文件、倾印调试内容、文件大纲。yaml介绍")]),t._v(" "),s("li",[t._v("大小写敏感；缩进不允许使用tab，只允许空格；缩进的空格数不重要，只要相同层级的元素左对齐即可；’#'表示注释；使用缩进表示层级关系。")])]),t._v(" "),s("p",[t._v("Yolov5的配置文件为"),s("code",[t._v("yaml")]),t._v("类型，"),s("code",[t._v("*.yaml")]),t._v("文件通过"),s("code",[t._v("yolo.py")]),t._v("解析文件配置模型的网络结构。yaml文件配置网络的好处是十分的方便不需要像Yolov3的config设置网络一样进行叠加，只需要在yaml配置文件中的参数进行修改即可。")]),t._v(" "),s("p",[t._v("这样做的好处是可以通过这两个参数控制网络的宽度和深度，实现不同大小不同复杂度的模型设计，但是这种写法缺点是不再能直接采用第三方工具例如netron进行网络模型可视化。")]),t._v(" "),s("h3",{attrs:{id:"yaml里有什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yaml里有什么"}},[t._v("#")]),t._v(" yaml里有什么")]),t._v(" "),s("p",[t._v("为了更好的了解和修改yolov5的配置文件,这里以"),s("a",{attrs:{href:"https://github.com/ultralytics/yolov5/blob/master/models/yolov5s.yaml",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Yolov5s.yaml")])]),t._v("为例，文件内共分为四个部分。")]),t._v(" "),s("p",[t._v("yolov5提供了s、m、l、x四种，所有的yaml文件都设置差不多，只有上面2和3的设置不同，作者团队很厉害，只需要修改这两个参数就可以调整模型的网络结构。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/114313216-f0a5e100-9af5-11eb-8445-c682b60da2e3.png",alt:"img"}})]),t._v(" "),s("h4",{attrs:{id:"parameters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[t._v("#")]),t._v(" parameters")]),t._v(" "),s("p",[t._v("负责模型的深度和宽度")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# parameters  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# number of classes  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depth_multiple")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.33")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# model depth multiple  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("width_multiple")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.50")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# layer channel multiple  ")]),t._v("\n")])])]),s("p",[s("code",[t._v("nc")]),t._v("：目标的类别数量。")]),t._v(" "),s("p",[s("code",[t._v("depth_multiple")]),t._v("：模型深度 控制模块的数量，当模块的数量number不为1时，模块的数量 = number * depth。")]),t._v(" "),s("p",[s("code",[t._v("width_multiple")]),t._v("：模型的宽度 控制卷积核的数量 ，卷积核的数量 = 数量 * width。")]),t._v(" "),s("blockquote",[s("p",[t._v("depth_multiple 是用在backbone中的number≠1的情况下， 即在Bottleneck层使用，控制模型的深度，yolov5s中设置为0.33，假设yolov5l中有三个Bottleneck，那yolov5s中就只有一个Bottleneck。\n因为一般number=1表示的是功能背景的层，比如说下采样Conv、Focus、SPP（空间金字塔池化）。")]),t._v(" "),s("p",[t._v("width_multiple 主要是用于设置arguments，例如yolov5s设置为0.5，Focus就变成[32, 3]，Conv就变成[64, 3, 2]。\n以此类推，卷积核的个数都变成了设置的一半。")])]),t._v(" "),s("h4",{attrs:{id:"acnhor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acnhor"}},[t._v("#")]),t._v(" Acnhor")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# anchors  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anchors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# P3/8  检测小目标  10，13是一组尺寸，一共三组  ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("61")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("62")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("119")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# P4/16     ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("116")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("156")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("198")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("373")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("326")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# P5/32  检测大目标  ")]),t._v("\n")])])]),s("p",[t._v("yolov5已经在yaml预设好了输入图像为640*640分辨率对应的anchor尺寸，yolov5的anchor也是在大特征图上检测小目标，在小特征图上检测大目标。三个特征图，每个特征图上的格子有三种尺寸的anchor。")]),t._v(" "),s("h4",{attrs:{id:"backbone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backbone"}},[t._v("#")]),t._v(" Backbone")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# YOLOv5 backbone  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backbone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# from   第一列 输入来自哪一层  -1代表上一层，-2表示从上两层获得的输入， 4代表第4层     ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# number 第二列 卷积核的数量    最终数量需要乘上width  1表示只有一个，3表示有三个相同的模块")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# module 第三列 模块名称 包括：Conv Focus BottleneckCSP  SPP  ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# args   第四列 模块的参数   ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [from, number, module, args]  ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Focus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 0-P1/2  ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1-P2/4 卷积核的数量 = 128 * wedith = 128*0.5=64        ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       模块数量 = 3 * depth =3"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*0.33=1")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3-P3/8     ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       模块数量 = 9 * depth =9"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*0.33=3")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5-P4/16      ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7-P5/32      ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SPP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 9  ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n")])])]),s("ul",[s("li",[s("p",[s("code",[t._v("Focus")]),t._v("：对特征图的切片操作，模块参数args分析： [[-1, 1, Focus, [64, 3]] 中的 [64, 3] 解析得到[3, 32, 3] ，输入为3（RGB），输出为64"),s("em",[t._v("0.5 = 32，3是卷积核 3")]),t._v("3")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Conv")]),t._v("：这里的Conv由conv+Bn+Leaky_relu激活函数三者组成，模块参数args分析：[-1, 1, Conv, [128, 3, 2]]中的128 是卷积核数量，最终数量需要乘上width = 128 "),s("em",[t._v("0.5 = 64，3是卷积核 3")]),t._v("3，2是步长。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("BottleneckCSP")]),t._v("：借鉴CSPNet网络结构，由三个卷积层和X个Res unint模块Concate组成，如果带有False参数就是没有使用Res unint模块，而是采用conv+Bn+Leaky_relu")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("SPP")]),t._v("：采用1×1，5×5，9×9，13×13的最大池化的方式，进行多尺度融合。")])])]),t._v(" "),s("h4",{attrs:{id:"head"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#head"}},[t._v("#")]),t._v(" Head")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# YOLOv5 head  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nn.Upsample"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nearest'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     上采样  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Concat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#cat backbone P4 [-1, 6]代表cat上一层和第6层  ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 13 第13层        ")]),t._v("\n     \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nn.Upsample"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nearest'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     上采样  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Concat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#cat backbone P3 [-1,4]代表cat上一层和第4层  ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 17 (P3/8-small)    第17层  ")]),t._v("\n  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Concat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#cat head P4 [-1,14]代表cat上一层和第14层  ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 20 (P4/16-medium)  第20层  ")]),t._v("\n  \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Conv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                       \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Concat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#cat head P5 [-1,10]代表cat上一层和第10层  ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BottleneckCSP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 23 (P5/32-large)  第23层  ")]),t._v("\n     \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Detect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Detect(P3, P4, P5)  ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Detect [17, 20, 23] 代表输入的层数17和20和23  ")]),t._v("\n")])])]),s("p",[t._v("Yolov5 Head 包括 Neck 和 Detector head 两部分，Neck部分使用了PANet的结构， Detector head使用和yolov3一样的head。其中，BottleneckCSP带有False参数说明没有使用Res unit结构而是采用了conv+Bn+Leaky_relu。")]),t._v(" "),s("h2",{attrs:{id:""}},[s("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),s("h2",{attrs:{id:"模型训练"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模型训练"}},[t._v("#")]),t._v(" 模型训练")]),t._v(" "),s("p",[t._v("为了训练我们的检测器，我们采取以下步骤：")]),t._v(" "),s("ul",[s("li",[t._v("安装 YOLOv5 依赖项")]),t._v(" "),s("li",[t._v("加载自定义 YOLOv5 数据集")]),t._v(" "),s("li",[t._v("定义 YOLOv5 模型配置和架构")]),t._v(" "),s("li",[t._v("训练自定义 YOLOv5 检测器")]),t._v(" "),s("li",[t._v("评估 YOLOv5 性能")]),t._v(" "),s("li",[t._v("可视化 YOLOv5 训练数据")]),t._v(" "),s("li",[t._v("在测试图像上运行 YOLOv5 推理")]),t._v(" "),s("li",[t._v("导出保存的 YOLOv5 权重以供将来推理")])]),t._v(" "),s("h3",{attrs:{id:"step01-安装-yolov5-依赖项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step01-安装-yolov5-依赖项"}},[t._v("#")]),t._v(" Step01-安装 YOLOv5 依赖项")]),t._v(" "),s("p",[t._v("要从 YOLOv5 开始，我们首先克隆 YOLOv5 存储库并安装依赖项。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!git clone https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ultralytics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov5  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# clone repo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd yolov5\n")])])]),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702201537419.png",alt:"image-20210702201537419"}})]),t._v(" "),s("p",[t._v("安装依赖环境和wandb包。wandb现在与YOLOv5集成，用于训练运行的实时可视化和云记录，具体可以查看"),s("a",{attrs:{href:"https://wandb.ai/cayush/yolov5-dsviz-demo/reports/Object-Detection-with-YOLO-and-Weights-Biases--Vmlldzo0NTgzMjk",target:"_blank",rel:"noopener noreferrer"}},[t._v("wandb官网的介绍")]),t._v("和Yolov5对其的介绍："),s("a",{attrs:{href:"https://github.com/ultralytics/yolov5/issues/1289",target:"_blank",rel:"noopener noreferrer"}},[t._v("Weights & Biases with YOLOv5 🌟 #1289")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!pip install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r requirements"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt\n!pip install wandb\n")])])]),s("p",[t._v("然后，我们可以看看我们从 Google Colab 免费提供给我们的训练环境。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看torch版本和gpu")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" torch\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" IPython"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" clear_output  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to display images")]),t._v("\n\nclear_output"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Setup complete. Using torch ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__version__"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" (")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cuda"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_device_properties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cuda"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_available"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CPU'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(')"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Setup complete"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Using torch "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.9")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("cu102 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Tesla T4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("根据"),s("a",{attrs:{href:"https://cloud.google.com/blog/products/ai-machine-learning/nvidia-tesla-t4-gpus-now-available-in-beta",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google官网")]),t._v("显示，colab的T4应该只在部分地区开放，我这里用的是东京的ip来白嫖。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/T4_Regional_Availability.max-2200x2200.png",alt:"gcp_nvidia_t4.png"}}),t._v(" "),s("p",[t._v("之后我们测试是否安装成功")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用官方数据进行测试")]),t._v("\n!python detect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weights yolov5s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("img "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("640")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("conf "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.25")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("source data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#需要注意路径，一般而言每运行一次都会新建一个exp")]),t._v("\nImage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'runs/detect/exp/zidane.jpg'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" width"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"step02-加载自定义-yolov5-数据集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step02-加载自定义-yolov5-数据集"}},[t._v("#")]),t._v(" Step02-加载自定义 YOLOv5 数据集")]),t._v(" "),s("p",[t._v("因为数据集不是很大，我这里最开始使用的google drive上传数据集的模式。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702225219971.png",alt:"image-20210702225219971"}})]),t._v(" "),s("p",[t._v("目前colab已经默认挂载google网盘，放置在"),s("code",[t._v("/drive/")]),t._v("文件夹，因此我们直接解压就好")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!unzip "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("uq "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolov5_gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detct_colab"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolov5_gw_dataset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("zip")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d Yolov5_gw_dataset \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#现在是在yolov5文件夹内，所以直接解压到当前文件夹")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210701203347221.png",alt:"image-20210701203347221"}})]),t._v(" "),s("h3",{attrs:{id:"step03-定义-yolov5-模型配置和架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step03-定义-yolov5-模型配置和架构"}},[t._v("#")]),t._v(" Step03-定义 YOLOv5 模型配置和架构")]),t._v(" "),s("p",[t._v("训练COCO数据集或者是VOC数据集，可以直接使用已经配置好的"),s("code",[t._v("coco.yaml")]),t._v(" 和 "),s("code",[t._v("voc.yaml")]),t._v("文件。如果训练别的数据集，则需要模仿coco.yaml 文件写一个自己的"),s("code",[t._v(".yaml")]),t._v("文件保存在data文件夹下。我们创建数据集的配置文件"),s("code",[t._v("gw_detect.yaml")]),t._v("，指定了数据集的位置和分类信息。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# train and val data as 1) directory: path/images/, 2) file: path/images.txt, or 3) list: [path1/images/, path2/images/]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#训练和验证集的路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("train")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./Yolov5_gw_dataset/images/train/\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("val")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./Yolov5_gw_dataset/images/val/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类别数目")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类别名字")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gun'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sword'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("同样的我们将它上传到谷歌网盘，然后在colab使用。")]),t._v(" "),s("h3",{attrs:{id:"step04-训练-yolov5-检测器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step04-训练-yolov5-检测器"}},[t._v("#")]),t._v(" Step04-训练 YOLOv5 检测器")]),t._v(" "),s("p",[t._v("我们设置完"),s("code",[t._v("gw_detect.yaml")]),t._v("后，就可以通过运行Yolov5目录下的"),s("code",[t._v("train.py")]),t._v("开始训练模型。训练配置可以通过命令行运行"),s("code",[t._v("train.py")]),t._v("的方式输入。相关参数可以查看"),s("code",[t._v("train.py")]),t._v("，也有博客对其进行了介绍："),s("a",{attrs:{href:"https://blog.csdn.net/Q1u1NG/article/details/107463417",target:"_blank",rel:"noopener noreferrer"}},[t._v("YOLOV5训练代码train.py注释与解析")]),t._v("。")]),t._v(" "),s("p",[t._v("为了开始训练，我们使用以下选项运行训练命令：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("--img")]),t._v("：定义输入图像大小")]),t._v(" "),s("li",[s("code",[t._v("--epochs")]),t._v("：迭代轮次，这里设置为500")]),t._v(" "),s("li",[s("code",[t._v("--batch-size")]),t._v("：硬件不好的话，把16改为8或者4甚至更低（yolov5支持更小，这里白嫖的是colab的tesla T4，就直接16了）")]),t._v(" "),s("li",[s("code",[t._v("--weights")]),t._v("：可以不加载预训练模型，这里改成无，当然也可以加载，这里使用yolov5s，具体模型选取看yolov5官方仓库的数据（也可以加载云盘中训练好的模型权重）")]),t._v(" "),s("li",[s("code",[t._v("--data")]),t._v("：指定配置文件的位置")]),t._v(" "),s("li",[s("code",[t._v("--cache")]),t._v("：缓存图像以加快训练速度")]),t._v(" "),s("li",[s("code",[t._v("--upload_dataset")]),t._v("：wandb中的参数，在模型训练时将数据集作为DSViz表上传wandb，后续可以云端分享和读取\n"),s("ul",[s("li",[t._v("If the dataset is logged in you W&B dasboard, you get training progress artifacts which compares the predictions from each epoch with their ground truths（如果数据集记录在你的W&B数据板上，你会得到训练进度工件，它将每个历元的预测与它们的基本事实进行比较）")])])]),t._v(" "),s("li",[s("code",[t._v("--save_preiod")]),t._v("：设置在将模型检查点记录为工件之前要等待的epoch数。如果未设置，则只记录最终训练的模型）")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!python train"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("img "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("640")]),t._v(" \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("batch "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("  \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("epochs "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("  \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolov5_gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detct_colab"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gw_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yaml \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weights yolov5s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pt  \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("project Yolo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("wandb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detect \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("upload_dataset \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("save_period "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cache \n")])])]),s("p",[t._v("接着就开始训练了，由于我们使用了wandb作为网络模型可视化，这里会弹出让我们填写api key的选项，点击链接进行填写就行。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702200510369.png",alt:"image-20210702200510369"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702200608586.png",alt:"image-20210702200608586"}})]),t._v(" "),s("p",[t._v("点击进去我们可以看到模型的相关运行效果、机器的内存占用数。其中wandb项目可以进行云端分享和读取")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702204237805.png",alt:"image-20210702204237805"}})]),t._v(" "),s("p",[t._v("此外wandb允许我们可以通过复制run path参数进行中断后的运行（可以异地运行）。具体可以查看wandb官方的"),s("a",{attrs:{href:"https://colab.research.google.com/drive/1CRC7kxYTIQQysowbrT2L6ctPen6ZQVeN?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[t._v("colab笔记本")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!python train"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("resume wandb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("artifact"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("insert run path of crashed run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("经过半个多小时，500个epoch跑完（比用K80快了十几分钟）")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702223125631.png",alt:"image-20210702223125631"}})]),t._v(" "),s("ul",[s("li",[s("code",[t._v("last.pt")]),t._v("是最近一次迭代的模型")]),t._v(" "),s("li",[s("code",[t._v("best.pt")]),t._v("是最好效果的模型")])]),t._v(" "),s("h3",{attrs:{id:"step05-评估自定义-yolov5-检测器性能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step05-评估自定义-yolov5-检测器性能"}},[t._v("#")]),t._v(" Step05-评估自定义 YOLOv5 检测器性能")]),t._v(" "),s("p",[t._v("现在我们已经完成了训练，我们可以通过查看验证指标来评估训练过程的执行情况。")]),t._v(" "),s("p",[t._v("最简单的方法是点击wandb的网页显示，直接查看wandb生成的结果图。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702211656117.png",alt:"image-20210702211656117"}})]),t._v(" "),s("p",[t._v("在jupyter中，可以直接读取"),s("code",[t._v("/results.png")]),t._v("文件")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\n如果要做图的话，可以参考官方colab\nfrom utils.plots import plot_results \nplot_results(save_dir='runs/train/exp')  # plot all results*.txt files in 'runs/train/exp' \n# 'runs/train/exp'为运行文件目录，如果第二次运行，就是存放在exp2，要相应地进行修改\nImage(filename='runs/train/exp/results.png', width=800)\n'''")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#这里wandb已经帮我作图了，直接读取就好")]),t._v("\nImage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Yolo-wandb-gw-detect/exp/results.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" width"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("800")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/result.png",alt:"result"}})]),t._v(" "),s("h3",{attrs:{id:"step06-可视化-yolov5-训练数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step06-可视化-yolov5-训练数据"}},[t._v("#")]),t._v(" Step06-可视化 YOLOv5 训练数据")]),t._v(" "),s("p",[t._v("在训练期间，YOLOv5 训练管道通过增强创建了一批训练数据。我们可以可视化训练数据的真实情况以及增强的训练数据")]),t._v(" "),s("h3",{attrs:{id:"step07-在测试图像上运行-yolov5-推理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step07-在测试图像上运行-yolov5-推理"}},[t._v("#")]),t._v(" Step07-在测试图像上运行 YOLOv5 推理")]),t._v(" "),s("p",[t._v("现在我们使用我们训练好的模型并对测试图像进行推断。训练完成后，模型权重将保存在"),s("code",[t._v("weights/")]),t._v("。")]),t._v(" "),s("p",[t._v("对于推理，我们调用这些权重以及"),s("code",[t._v("--conf")]),t._v("指定的模型置信度（所需的置信度越高，预测越少）。")]),t._v(" "),s("p",[t._v("通过"),s("code",[t._v("source")]),t._v("来指定输入文件目录 。"),s("code",[t._v("source")]),t._v("可以接受图像目录、单个图像、视频文件以及设备的网络摄像头端口。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!python detect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py \n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weights Yolo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("wandb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detect"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("exp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("weights"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("best"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pt \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("img "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("416")]),t._v(" \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("conf "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.4")]),t._v(" \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("source "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolov5_gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detct_colab"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gw_test_image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("fig_sword_01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jpg\n")])])]),s("p",[t._v("在这里我们使用网盘中的"),s("code",[t._v("Yolov5_gw-detct_colab/gw_test_image/fig_sword_01.jpg")]),t._v("进行测试")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702224615976.png",alt:"image-20210702224615976"}})]),t._v(" "),s("p",[t._v("可以看到在T4上只用了0.307s检测")]),t._v(" "),s("p",[t._v("由于已经运行过一次测试集（最开始测试yolov5安装是否成功的图片），所以这次检测测试输出在"),s("code",[t._v("exp2")]),t._v("文件夹。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("Image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/yolov5/runs/detect/exp2/fig_sword_01.jpg'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("width"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("看起来检测效果还行。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702224458443.png",alt:"image-20210702224458443"}})]),t._v(" "),s("p",[t._v("把测试文件夹的其他图片也检测了")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#干脆全部检测一遍")]),t._v("\n!python detect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py \n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weights Yolo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("wandb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detect"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("exp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("weights"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("best"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pt \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("img "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("416")]),t._v(" \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("conf "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.4")]),t._v(" \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("source "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolov5_gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detct_colab"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gw_test_image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),s("p",[t._v("七张图片共用时2.632s")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210702224742448.png",alt:"image-20210702224742448"}})]),t._v(" "),s("h3",{attrs:{id:"step08-导出保存的-yolov5-权重以供将来推理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step08-导出保存的-yolov5-权重以供将来推理"}},[t._v("#")]),t._v(" Step08-导出保存的 YOLOv5 权重以供将来推理")]),t._v(" "),s("p",[t._v("主要的文件就是weights文件夹下的best.pt，由于是在colab运行的，所以可以直接点击下载进行保存，也可以保存到google云盘方便后续直接读取使用【备注：Yolov5是允许通过加载谷歌云盘上的模型作为预训练模型】")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("wandb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detect"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("exp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("weights"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("best"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("My\\ Drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Yolov5_gw"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detect_colab\n")])])]),s("p",[t._v("自从Yolov5模型训练的工作大体结束。")]),t._v(" "),s("h2",{attrs:{id:"stepx-优化和部署模型-可选"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stepx-优化和部署模型-可选"}},[t._v("#")]),t._v(" StepX-优化和部署模型（可选）")]),t._v(" "),s("p",[t._v("由于Yolov5是通过pytorch使用的，所以也可以视为pytorch模型转化为TensorRT")]),t._v(" "),s("p",[t._v("具体可以参考：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/365191541",target:"_blank",rel:"noopener noreferrer"}},[t._v("知乎：手把手教你使用yolov5训练自己的数据集并用TensorRT加速")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/88318324",target:"_blank",rel:"noopener noreferrer"}},[t._v("知乎：如何使用TensorRT对训练好的PyTorch模型进行加速?")])]),t._v(" "),s("p",[t._v("["),s("a",{attrs:{href:"https://github.com/wang-xinyu/tensorrtx",target:"_blank",rel:"noopener noreferrer"}},[t._v("tensorrtx")]),t._v("/"),s("strong",[t._v("yolov5")]),t._v("/](https://github.com/wang-xinyu/tensorrtx/tree/master/yolov5)")]),t._v(" "),s("h2",{attrs:{id:"stepy-形成报告"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stepy-形成报告"}},[t._v("#")]),t._v(" StepY-形成报告")]),t._v(" "),s("p",[t._v("得益于我们绑定了wandb进行可视化，我们可以利用wandb形成我们所需的报告（支持"),s("span",{staticClass:"katex"},[s("span",{staticClass:"katex-mathml"},[s("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[s("semantics",[s("mrow",[s("mi",[t._v("L")]),s("mi",[t._v("a")]),s("mi",[t._v("t")]),s("mi",[t._v("e")]),s("mi",[t._v("x")])],1),s("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("Latex")])],1)],1)],1),s("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[s("span",{staticClass:"base"},[s("span",{staticClass:"strut",staticStyle:{height:"0.68333em","vertical-align":"0em"}}),s("span",{staticClass:"mord mathnormal"},[t._v("L")]),s("span",{staticClass:"mord mathnormal"},[t._v("a")]),s("span",{staticClass:"mord mathnormal"},[t._v("t")]),s("span",{staticClass:"mord mathnormal"},[t._v("e")]),s("span",{staticClass:"mord mathnormal"},[t._v("x")])])])]),t._v("和markdown语言）。只要进入自己的wandb界面就可以看到项目，点击进去右上角就有导出报告选项。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703223701856.png",alt:"image-20210703223701856"}}),t._v(" "),s("p",[t._v("这些图可以在项目界面进行预览")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703223802793.png",alt:"image-20210703223802793"}}),t._v(" "),s("p",[t._v("形成的报告可以分享给别人，项目也可以邀请他人协作。")]),t._v(" "),s("p",[t._v("该项目的wandb形成报告：https://wandb.ai/chancey/yolo-wandb-gw-detect/reports/Copy-of-chancey-s---Vmlldzo4MjE1OTA/")]),t._v(" "),s("p",[t._v("wandb地址：https://wandb.ai/chancey/yolo-wandb-gw-detect/overview?workspace=user-chancey")]),t._v(" "),s("h2",{attrs:{id:"结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[t._v("#")]),t._v(" 结果")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/result.png",alt:"result"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703224231700.png",alt:"image-20210703224231700"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703224223085.png",alt:"image-20210703224223085"}})]),t._v(" "),s("h2",{attrs:{id:"补充材料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#补充材料"}},[t._v("#")]),t._v(" 补充材料")]),t._v(" "),s("h3",{attrs:{id:"其他项目补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他项目补充"}},[t._v("#")]),t._v(" 其他项目补充")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://towardsdatascience.com/how-to-track-football-players-using-yolo-sort-and-opencv-6c58f71120b8",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何使用 Yolo、SORT 和 Opencv 跟踪足球运动员")])]),t._v(" "),s("p",[t._v("检测王者荣耀中的英雄小兵野怪等"),s("a",{attrs:{href:"https://colab.research.google.com/drive/1D9LkkNgmQ1sZxCxnJrfJEyXGf25-Gdxu?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703223053458.png",alt:"image-20210703223053458"}})]),t._v("【数据集来源于b站用户的"),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1fN41197r8?from=search&seid=2951274229628230627",target:"_blank",rel:"noopener noreferrer"}},[t._v("分享")]),t._v("，可以阅读腾讯的文献"),s("a",{attrs:{href:"https://arxiv.org/abs/1907.07854",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v('Understanding Video Content: Efficient Hero Detection and Recognition for the Game "Honor of Kings"')])]),t._v("，基于yolo框架用更细致的数据处理，可以区分敌我和精彩时刻，腾讯云上的"),s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1121706",target:"_blank",rel:"noopener noreferrer"}},[t._v("解读")]),t._v("）")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://test-123-imagebed.oss-cn-beijing.aliyuncs.com/img/image-20210703215954771.png",alt:"image-20210703215954771"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);